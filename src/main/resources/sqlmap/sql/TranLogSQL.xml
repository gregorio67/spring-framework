<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sehati.inf.translog">

	<!-- Transaction Log sequence -->
	<select id="selTransLogSeq"  resultType="int">
		SELECT SQ_TRANS_LOG_01.NEXTVAL FROM DUAL
	</select>
	
	<select id="selTransLog" parameterType="java.util.Map" resultType="cmn.util.dao.CamelMap">
		SELECT
			TRAN_SEQ,
			SERVER_ID,
			START_TIME,
			END_TIME,
			CALL_START_TIME,
			CALL_END_TIME,
			INTERFACE_ID,
			INTERFACE_NAME,
			STATUS,
			EXIT_CODE,
			EXIT_MESSAGE,
			CLIENT_ID,
			CLIENT_IP,
			AUTH_KEY,
			REQUEST_DATA,
			RESPONSE_DATA,
			SOURCE_SERVER,
			TARGET_SERVER
		FROM TRANS_LOG
		WHERE 1 = 1
		<if test = 'startTime != "" and startTime != null'>
			AND START_TIME >= #{startTime}
		</if>
		<if test = 'endTime != "" and endTime != null'>
			AND END_TIME >= #{endTime}
		</if>
		<if test = 'status != "" and status != null'>
			AND STATUS = #{status}
		</if>		
		<if test = 'interfaceId != "" and interfaceId != null'>
			AND INTERFACE_ID = #{interfaceId}
		</if>
		ORDER BY START_TIME DESC

	</select>

	<insert id="insTransLog" parameterType="java.util.Map">
		INSERT
		INTO TRANS_LOG (
				TRAN_SEQ,	
				SERVER_ID,		
				START_TIME,		
				END_TIME,	
				CALL_START_TIME,	
				CALL_END_TIME,
				INTERFACE_ID,
				INTERFACE_NAME,
				STATUS,
				EXIT_CODE,
				EXIT_MESSAGE,
				CLIENT_ID,
				CLIENT_IP,
				AUTH_KEY,
				REQUEST_DATA,
				RESPONSE_DATA,
				SOURCE_SERVER,
				TARGET_SERVER)
		VALUES(	
				#{tranSeq},
				#{serverId},
				#{startTime},
				#{endTime},
				#{callStartTime},
				#{callEndTime},
				#{interfaceId},
				#{interfaceName},
				#{status},
				#{exitCode},
				#{exitMessage},
				#{clientId},
				#{clientIp},
				#{authKey},
				#{requestData},
				#{responseData},
				#{sourceServer},
				#{targetServer})
	</insert>

	<!-- Transaction Log Update -->
	<update id="updTransLog" parameterType="java.util.Map">
		UPDATE TRANS_LOG
		SET END_TIME = #{endTime},
			CALL_START_TIME = #{callStartTime},
			CALL_END_TIME = #{callEndTime},
			STATUS = #{status},	
			EXIT_CODE = #{exitCode},
			EXIT_MESSAGE = #{exitMessage},
			RESPONSE_DATA = #{responseData}
		WHERE TRAN_SEQ = #{tranSeq}
	</update>
	
</mapper>
